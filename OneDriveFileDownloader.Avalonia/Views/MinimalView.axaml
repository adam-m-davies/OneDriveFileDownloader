<?xml version="1.0" encoding="utf-8"?>
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="OneDriveFileDownloader.Avalonia.Views.MinimalView">
  <Grid RowDefinitions="Auto, *">
    <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
      <TextBlock Text="Downloads" FontSize="24" FontWeight="SemiBold" />
      <StackPanel Orientation="Horizontal" Spacing="12">
        <Button Content="Download Selected" Command="{Binding DownloadCommand}" CommandParameter="{Binding SelectedVideo}" Classes="accent" />
        <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
      </StackPanel>
    </StackPanel>

    <TextBlock Grid.Row="1" Text="No video files found. Try scanning or check your OneDrive." 
               IsVisible="{Binding Videos.Count, Converter={StaticResource EmptyToVisibleConverter}}"
               HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />

    <ListBox Grid.Row="1" x:Name="VideosList" ItemsSource="{Binding Videos}" SelectedItem="{Binding SelectedVideo, Mode=TwoWay}" 
             IsVisible="{Binding Videos.Count, Converter={StaticResource CountToVisibleConverter}}"
             Background="Transparent" BorderThickness="0">
      <ListBox.ItemTemplate>
        <DataTemplate>
          <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="4" Margin="0,2" Padding="12">
            <Grid ColumnDefinitions="Auto, *, 150, 100, Auto">
              <!-- Status Icon -->
              <Ellipse Grid.Column="0" Width="10" Height="10" Fill="{Binding Status, Converter={StaticResource StatusToBrushConverter}}" VerticalAlignment="Center" Margin="0,0,16,0" />
              
              <!-- File Info -->
              <StackPanel Grid.Column="1" VerticalAlignment="Center">
                <TextBlock Text="{Binding File.Name}" FontWeight="Medium" TextTrimming="CharacterEllipsis" />
                <TextBlock Text="{Binding Status}" FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
              </StackPanel>

              <!-- Progress -->
              <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="16,0" IsVisible="{Binding IsDownloading}">
                <ProgressBar Height="4" Minimum="0" Maximum="100" Value="{Binding Progress}" />
                <Grid ColumnDefinitions="*, *">
                  <TextBlock Grid.Column="0" Text="{Binding Progress, StringFormat='{}{0:N0}%'}" FontSize="10" />
                  <TextBlock Grid.Column="1" Text="{Binding EstimatedSecondsRemaining, Converter={StaticResource SecondsToEtaConverter}}" FontSize="10" HorizontalAlignment="Right" />
                </Grid>
              </StackPanel>

              <!-- Stats -->
              <TextBlock Grid.Column="3" Text="{Binding RetryCount, StringFormat='Retries: {0}'}" FontSize="11" VerticalAlignment="Center" HorizontalAlignment="Center" IsVisible="{Binding RetryCount, Converter={StaticResource CountToVisibleConverter}}" />

              <!-- Actions -->
              <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="4">
                <Button Content="" FontFamily="Segoe MDL2 Assets" ToolTip.Tip="Download" Command="{Binding DataContext.DownloadCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}" IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}" Background="Transparent" BorderThickness="0" />
                <Button Content="" FontFamily="Segoe MDL2 Assets" ToolTip.Tip="Cancel" Command="{Binding DataContext.CancelCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}" IsVisible="{Binding IsDownloading}" Background="Transparent" BorderThickness="0" Foreground="Red" />
                <Button Content="" FontFamily="Segoe MDL2 Assets" ToolTip.Tip="Retry" Command="{Binding DataContext.RetryCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}" IsEnabled="{Binding IsRetryAllowed}" Background="Transparent" BorderThickness="0" />
              </StackPanel>
            </Grid>
          </Border>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </Grid>
</UserControl>
