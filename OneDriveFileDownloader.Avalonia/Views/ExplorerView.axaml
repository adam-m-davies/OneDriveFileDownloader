<?xml version="1.0" encoding="utf-8"?>
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="OneDriveFileDownloader.Avalonia.Views.ExplorerView">
  <Grid ColumnDefinitions="*, 2*" RowDefinitions="*">
    <Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Margin="0,0,8,0" Padding="0">
      <Grid RowDefinitions="Auto, Auto, *">
        <Border Grid.Row="0" Padding="16,12" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1">
          <Grid ColumnDefinitions="*, Auto">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="&#xE8F1;" FontFamily="Segoe MDL2 Assets" FontSize="16" VerticalAlignment="Center" Foreground="{DynamicResource SystemAccentColor}" />
              <TextBlock Text="Shared Folders" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" />
            </StackPanel>
            <TextBlock Grid.Column="1" Text="{Binding FolderRoots.Count, StringFormat='{}{0} items'}" FontSize="12" VerticalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          </Grid>
        </Border>
        <Button Grid.Row="1" x:Name="AddSharedUrlBtn" Command="{Binding AddSharedUrlCommand}" HorizontalAlignment="Stretch" Margin="12,12,12,8" Padding="12,10" Classes="accent">
          <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
            <TextBlock Text="&#xE710;" FontFamily="Segoe MDL2 Assets" FontSize="14" VerticalAlignment="Center" />
            <TextBlock Text="Add from OneDrive URL" VerticalAlignment="Center" FontWeight="Medium" />
          </StackPanel>
        </Button>
        <Grid Grid.Row="2">
          <StackPanel IsVisible="{Binding !FolderRoots.Count}" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12" Margin="20">
            <TextBlock Text="&#xE8B7;" FontFamily="Segoe MDL2 Assets" FontSize="48" HorizontalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" />
            <TextBlock Text="No shared folders yet" HorizontalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
            <TextBlock Text="Click the button above to add shared folders from OneDrive web" HorizontalAlignment="Center" TextAlignment="Center" FontSize="12" TextWrapping="Wrap" Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" />
          </StackPanel>
          <TreeView x:Name="FolderTree" ItemsSource="{Binding FolderRoots}" SelectedItem="{Binding SelectedNode, Mode=TwoWay}" Background="Transparent" Margin="8,4,8,8" IsVisible="{Binding FolderRoots.Count}">
            <TreeView.Styles>
              <Style Selector="TreeViewItem">
                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                <Setter Property="Padding" Value="4" />
              </Style>
            </TreeView.Styles>
            <TreeView.ItemTemplate>
              <TreeDataTemplate ItemsSource="{Binding Children}">
                <Border Padding="6,4" CornerRadius="4">
                  <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="&#xE8B7;" FontFamily="Segoe MDL2 Assets" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource SystemAccentColor}" />
                    <TextBlock Text="{Binding Item.Name}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" />
                  </StackPanel>
                </Border>
              </TreeDataTemplate>
            </TreeView.ItemTemplate>
          </TreeView>
        </Grid>
      </Grid>
    </Border>
    <Border Grid.Column="1" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="8" Padding="0">
      <Grid RowDefinitions="Auto, Auto, *">
        <Border Grid.Row="0" Padding="16,12" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1">
          <Grid ColumnDefinitions="*, Auto">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="16" VerticalAlignment="Center" Foreground="{DynamicResource SystemAccentColor}" />
              <TextBlock Text="{Binding SelectedNode.Item.Name, FallbackValue='Contents'}" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" MaxWidth="300" />
            </StackPanel>
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16">
              <CheckBox Content="Auto-scan" IsChecked="{Binding ScanOnSelection}" VerticalAlignment="Center" ToolTip.Tip="Automatically scan for files when selecting a folder" />
              <Button x:Name="ScanFolderBtn" Command="{Binding ScanFolderCommand}" Padding="10,6" IsVisible="{Binding !ScanOnSelection}" IsEnabled="{Binding SelectedNode, Converter={x:Static ObjectConverters.IsNotNull}}">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="&#xE721;" FontFamily="Segoe MDL2 Assets" VerticalAlignment="Center" />
                  <TextBlock Text="Scan" VerticalAlignment="Center" />
                </StackPanel>
              </Button>
            </StackPanel>
          </Grid>
        </Border>
        <Border Grid.Row="1" Padding="16,8" IsVisible="{Binding SelectedNode, Converter={x:Static ObjectConverters.IsNotNull}}">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <TextBlock Text="&#xE80F;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
            <TextBlock Text="{Binding Videos.Count, StringFormat='{}{0} video files found'}" FontSize="12" VerticalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          </StackPanel>
        </Border>
        <Grid Grid.Row="2">
          <StackPanel IsVisible="{Binding SelectedNode, Converter={x:Static ObjectConverters.IsNull}}" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
            <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="64" HorizontalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" />
            <TextBlock Text="Select a folder to view files" HorizontalAlignment="Center" FontSize="16" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          </StackPanel>
          <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
            <StackPanel.IsVisible>
              <MultiBinding Converter="{x:Static BoolConverters.And}">
                <Binding Path="SelectedNode" Converter="{x:Static ObjectConverters.IsNotNull}" />
                <Binding Path="!Videos.Count" />
              </MultiBinding>
            </StackPanel.IsVisible>
            <TextBlock Text="&#xE714;" FontFamily="Segoe MDL2 Assets" FontSize="48" HorizontalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" />
            <TextBlock Text="No video files found" HorizontalAlignment="Center" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
            <TextBlock Text="Try scanning a different folder or subfolder" HorizontalAlignment="Center" FontSize="12" Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" />
          </StackPanel>
          <ScrollViewer IsVisible="{Binding Videos.Count}">
            <ItemsControl ItemsSource="{Binding Videos}" Margin="12,4,12,12">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" CornerRadius="6" Margin="0,4" Padding="12,10" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1">
                    <Grid ColumnDefinitions="Auto, *, Auto, Auto">
                      <Border Grid.Column="0" Width="40" Height="40" CornerRadius="4" Background="{DynamicResource SystemAccentColorLight3}" Margin="0,0,12,0">
                        <TextBlock Text="&#xE8B2;" FontFamily="Segoe MDL2 Assets" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{DynamicResource SystemAccentColorDark1}" />
                      </Border>
                      <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                        <TextBlock Text="{Binding File.Name}" FontWeight="Medium" FontSize="13" TextTrimming="CharacterEllipsis" />
                        <StackPanel Orientation="Horizontal" Spacing="12">
                          <TextBlock Text="{Binding Status}" FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                          <TextBlock Text="{Binding File.Size, StringFormat='{}{0:N0} bytes'}" FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" IsVisible="{Binding File.Size, Converter={x:Static ObjectConverters.IsNotNull}}" />
                        </StackPanel>
                      </StackPanel>
                      <ProgressBar Grid.Column="2" Width="100" Height="4" Margin="12,0" VerticalAlignment="Center" Value="{Binding ProgressPercent}" IsVisible="{Binding IsDownloading}" Classes="accent" />
                      <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4">
                        <Button ToolTip.Tip="Download" Command="{Binding DataContext.DownloadCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}" IsEnabled="{Binding !IsDownloading}" Padding="8" Background="Transparent" BorderThickness="0">
                          <TextBlock Text="&#xE896;" FontFamily="Segoe MDL2 Assets" FontSize="16" />
                        </Button>
                        <Button ToolTip.Tip="Cancel" Command="{Binding DataContext.CancelCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}" IsVisible="{Binding IsDownloading}" Padding="8" Background="Transparent" BorderThickness="0" Foreground="#E81123">
                          <TextBlock Text="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="16" />
                        </Button>
                        <Button ToolTip.Tip="Retry" Command="{Binding DataContext.RetryCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}" IsEnabled="{Binding IsRetryAllowed}" Padding="8" Background="Transparent" BorderThickness="0">
                          <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="16" />
                        </Button>
                      </StackPanel>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </Grid>
      </Grid>
    </Border>
  </Grid>
</UserControl>